<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Python YASMIN (Yet Another State MachINe): YASMIN (Yet Another State MachINe)</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Python YASMIN (Yet Another State MachINe)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">YASMIN (Yet Another State MachINe) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p align="center"></p>
<p><img src="./docs/logo.png" alt="" width="50%" class="inline"/> </p>
<p>YASMIN is a project focused on implementing robot behaviors using Finite State Machines (FSM). It is available for ROS 2, Python and C++.</p>
<p><a href="https://opensource.org/license/gpl-3-0"><img src="https://img.shields.io/badge/GitHub-GPL--3.0-informational" alt="License: MIT" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/releases"><img src="https://img.shields.io/github/release/uleroboticsgroup/yasmin.svg" alt="GitHub release" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin?branch=main"><img src="https://img.shields.io/github/languages/code-size/uleroboticsgroup/yasmin.svg?branch=main" alt="Code Size" style="pointer-events: none;" class="inline"/></a> <a href="https://libraries.io/github/uleroboticsgroup/yasmin?branch=main"><img src="https://img.shields.io/librariesio/github/uleroboticsgroup/yasmin?branch=main" alt="Dependencies" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/commits/main"><img src="https://img.shields.io/github/last-commit/uleroboticsgroup/yasmin.svg" alt="Last Commit" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/issues"><img src="https://img.shields.io/github/issues/uleroboticsgroup/yasmin" alt="GitHub issues" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/pulls"><img src="https://img.shields.io/github/issues-pr/uleroboticsgroup/yasmin" alt="GitHub pull requests" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/graphs/contributors"><img src="https://img.shields.io/github/contributors/uleroboticsgroup/yasmin.svg" alt="Contributors" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/python_formatter.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/python_formatter.yml/badge.svg?branch=main" alt="Python Formatter Check" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/cpp_formatter.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/cpp_formatter.yml/badge.svg?branch=main" alt="C++ Formatter Check" style="pointer-events: none;" class="inline"/></a></p>
<div align="center"></div><div align="center"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">ROS 2 Distro   </th><th class="markdownTableHeadCenter">Branch   </th><th class="markdownTableHeadCenter">Build status   </th><th class="markdownTableHeadCenter">Docker Image   </th><th class="markdownTableHeadNone">Documentation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Foxy</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/foxy-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/foxy-docker-build.yml/badge.svg?branch=main" alt="Foxy Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=foxy"><img src="https://img.shields.io/badge/Docker%20Image%20-foxy-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><b>Galatic</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/galactic-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/galactic-docker-build.yml/badge.svg?branch=main" alt="Galactic Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=galactic"><img src="https://img.shields.io/badge/Docker%20Image%20-galactic-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Humble</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/humble-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/humble-docker-build.yml/badge.svg?branch=main" alt="Humble Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=humble"><img src="https://img.shields.io/badge/Docker%20Image%20-humble-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><b>Iron</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/iron-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/iron-docker-build.yml/badge.svg?branch=main" alt="Iron Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=iron"><img src="https://img.shields.io/badge/Docker%20Image%20-iron-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Jazzy</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/jazzy-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/jazzy-docker-build.yml/badge.svg?branch=main" alt="Jazzy Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=jazzy"><img src="https://img.shields.io/badge/Docker%20Image%20-jazzy-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><b>Rolling</b>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/tree/main"><code>main</code></a>   </td><td class="markdownTableBodyCenter"><a href="https://github.com/uleroboticsgroup/yasmin/actions/workflows/rolling-docker-build.yml?branch=main"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/rolling-docker-build.yml/badge.svg?branch=main" alt="Rolling Build" style="pointer-events: none;" class="inline"/></a>   </td><td class="markdownTableBodyCenter"><a href="https://hub.docker.com/r/mgons/yasmin/tags?name=rolling"><img src="https://img.shields.io/badge/Docker%20Image%20-rolling-blue" alt="Docker Image" class="inline"/></a>   </td><td class="markdownTableBodyNone"><a href="https://uleroboticsgroup.github.io/yasmin/"><img src="https://github.com/uleroboticsgroup/yasmin/actions/workflows/doxygen-doc.yml/badge.svg" alt="Doxygen Deployment" style="pointer-events: none;" class="inline"/></a>   </td></tr>
</table>
</div><div align="center"></div><h1><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ol type="1">
<li>Features</li>
<li>Installation</li>
<li>Docker</li>
<li>Demos<ul>
<li>Python</li>
<li>Cpp</li>
</ul>
</li>
<li>YASMIN Viewer</li>
<li>Citations</li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Features</h1>
<ul>
<li>Fully integrated into ROS 2.</li>
<li>Available for Python and C++.</li>
<li>Fast prototyping.</li>
<li>Default states for ROS 2 action and service clients.</li>
<li>Blackboards are used to share data between states and state machines.</li>
<li>State machines can be canceled and stopped, which means stopping the current executing state.</li>
<li>A web viewer is included, which allows monitoring of the execution of the state machines.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Installation</h1>
<div class="fragment"><div class="line"># clone</div>
<div class="line">$ cd ~/ros2_ws/src</div>
<div class="line">$ git clone https://github.com/uleroboticsgroup/yasmin.git</div>
<div class="line"> </div>
<div class="line"># dependencies</div>
<div class="line">$ cd ~/ros2_ws</div>
<div class="line">$ rosdep install --from-paths src --ignore-src -r -y</div>
<div class="line">$ cd src/yasmin</div>
<div class="line">$ pip3 install -r requirements.txt</div>
<div class="line"> </div>
<div class="line"># colcon</div>
<div class="line">$ cd ~/ros2_ws</div>
<div class="line">$ colcon build</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Docker</h1>
<p>If your operating system doesn't support ROS 2 humble, docker is a great alternative. First of all, you have to build the project and create an image like so:</p>
<div class="fragment"><div class="line">## Assuming you are in the correct project directory</div>
<div class="line">$ docker build -t yasmin .</div>
</div><!-- fragment --><p>To use a shortcut, you may use the following command:</p>
<div class="fragment"><div class="line">## Assuming you are in the correct project directory</div>
<div class="line">$ make docker_build</div>
</div><!-- fragment --><p>After the image is created, run a docker container with the following command:</p>
<div class="fragment"><div class="line">## Assuming you are in the correct project directory</div>
<div class="line">$ docker run -it --net=host --ipc=host --privileged --env=&quot;DISPLAY&quot; --env=&quot;QT_X11_NO_MITSHM=1&quot; --volume=&quot;/tmp/.X11-unix:/tmp/.X11-unix:rw&quot; --volume=&quot;${XAUTHORITY}:/root/.Xauthority&quot; --entrypoint /bin/bash yasmin</div>
</div><!-- fragment --><p>To use a shortcut, you may use following command:</p>
<div class="fragment"><div class="line">$ make docker_run</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Running the docker image</h2>
<p>If you are in the docker image , this project is already sourced and the demo script can be run as the following command;</p>
<div class="fragment"><div class="line">$ cd /root/ros2_ws/</div>
<div class="line">$ ros2 run yasmin_demos yasmin_demo.py</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Demos</h1>
<p>There are some examples, for both Python and C++, that can be found in <a href="./yasmin_demos/">yasmin_demos</a>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Python</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
Vanilla Demo (FSM)</h3>
<div class="fragment"><div class="line">$ ros2 run yasmin_demos yasmin_demo.py</div>
</div><!-- fragment --><p><img src="./docs/demo.gif" alt="" width="65%" class="inline"/> </p>
<details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> time</div>
<div class="line"><span class="keyword">import</span> rclpy</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> yasmin</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> State</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> Blackboard</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> StateMachine</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a> <span class="keyword">import</span> set_ros_loggers</div>
<div class="line"><span class="keyword">from</span> yasmin_viewer <span class="keyword">import</span> YasminViewerPub</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># define state Foo</span></div>
<div class="line"><span class="keyword">class </span>FooState(State):</div>
<div class="line">    <span class="keyword">def </span>__init__(self) -&gt; None:</div>
<div class="line">        super().__init__([<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;outcome2&quot;</span>])</div>
<div class="line">        self.counter = 0</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>execute(self, blackboard: Blackboard) -&gt; str:</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;Executing state FOO&quot;</span>)</div>
<div class="line">        time.sleep(3)</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> self.counter &lt; 3:</div>
<div class="line">            self.counter += 1</div>
<div class="line">            blackboard[<span class="stringliteral">&quot;foo_str&quot;</span>] = f<span class="stringliteral">&quot;Counter: {self.counter}&quot;</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span></div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome2&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># define state Bar</span></div>
<div class="line"><span class="keyword">class </span>BarState(State):</div>
<div class="line">    <span class="keyword">def </span>__init__(self) -&gt; None:</div>
<div class="line">        super().__init__(outcomes=[<span class="stringliteral">&quot;outcome3&quot;</span>])</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>execute(self, blackboard: Blackboard) -&gt; str:</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;Executing state BAR&quot;</span>)</div>
<div class="line">        time.sleep(3)</div>
<div class="line"> </div>
<div class="line">        yasmin.YASMIN_LOG_INFO(blackboard[<span class="stringliteral">&quot;foo_str&quot;</span>])</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome3&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># main</span></div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line"> </div>
<div class="line">    yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_demo&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># init ROS 2</span></div>
<div class="line">    rclpy.init()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># set ROS 2 logs</span></div>
<div class="line">    set_ros_loggers()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create a FSM</span></div>
<div class="line">    sm = StateMachine(outcomes=[<span class="stringliteral">&quot;outcome4&quot;</span>])</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># add states</span></div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;FOO&quot;</span>,</div>
<div class="line">        FooState(),</div>
<div class="line">        transitions={</div>
<div class="line">            <span class="stringliteral">&quot;outcome1&quot;</span>: <span class="stringliteral">&quot;BAR&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;outcome2&quot;</span>: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;BAR&quot;</span>,</div>
<div class="line">        BarState(),</div>
<div class="line">        transitions={</div>
<div class="line">            <span class="stringliteral">&quot;outcome3&quot;</span>: <span class="stringliteral">&quot;FOO&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    <span class="comment"># pub FSM info</span></div>
<div class="line">    YasminViewerPub(<span class="stringliteral">&quot;yasmin_demo&quot;</span>, sm)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># execute FSM</span></div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        outcome = sm()</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(outcome)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        sm.cancel_state()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># shutdown ROS 2</span></div>
<div class="line">    <span class="keywordflow">if</span> rclpy.ok():</div>
<div class="line">        rclpy.shutdown()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    main()</div>
<div class="ttc" id="anamespaceyasmin__ros_1_1ros__logs_html"><div class="ttname"><a href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a></div><div class="ttdef"><b>Definition</b> ros_logs.py:1</div></div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md9"></a>
Service Demo (FSM + ROS 2 Service Client)</h3>
<div class="fragment"><div class="line">$ ros2 run demo_nodes_py add_two_ints_server</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ ros2 run yasmin_demos service_client_demo.py</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> rclpy</div>
<div class="line"><span class="keyword">from</span> example_interfaces.srv <span class="keyword">import</span> AddTwoInts</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> yasmin</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> CbState</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> Blackboard</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> StateMachine</div>
<div class="line"><span class="keyword">from</span> yasmin_ros <span class="keyword">import</span> ServiceState</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a> <span class="keyword">import</span> set_ros_loggers</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1basic__outcomes.html">yasmin_ros.basic_outcomes</a> <span class="keyword">import</span> SUCCEED, ABORT</div>
<div class="line"><span class="keyword">from</span> yasmin_viewer <span class="keyword">import</span> YasminViewerPub</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>AddTwoIntsState(ServiceState):</div>
<div class="line">    <span class="keyword">def </span>__init__(self) -&gt; None:</div>
<div class="line">        super().__init__(</div>
<div class="line">            AddTwoInts,  <span class="comment"># srv type</span></div>
<div class="line">            <span class="stringliteral">&quot;/add_two_ints&quot;</span>,  <span class="comment"># service name</span></div>
<div class="line">            self.create_request_handler,  <span class="comment"># cb to create the request</span></div>
<div class="line">            [<span class="stringliteral">&quot;outcome1&quot;</span>],  <span class="comment"># outcomes. Includes (SUCCEED, ABORT)</span></div>
<div class="line">            self.response_handler,  <span class="comment"># cb to process the response</span></div>
<div class="line">        )</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>create_request_handler(self, blackboard: Blackboard) -&gt; AddTwoInts.Request:</div>
<div class="line"> </div>
<div class="line">        req = AddTwoInts.Request()</div>
<div class="line">        req.a = blackboard[<span class="stringliteral">&quot;a&quot;</span>]</div>
<div class="line">        req.b = blackboard[<span class="stringliteral">&quot;b&quot;</span>]</div>
<div class="line">        <span class="keywordflow">return</span> req</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>response_handler(</div>
<div class="line">        self, blackboard: Blackboard, response: AddTwoInts.Response</div>
<div class="line">    ) -&gt; str:</div>
<div class="line"> </div>
<div class="line">        blackboard[<span class="stringliteral">&quot;sum&quot;</span>] = response.sum</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>set_ints(blackboard: Blackboard) -&gt; str:</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;a&quot;</span>] = 10</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;b&quot;</span>] = 5</div>
<div class="line">    <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>print_sum(blackboard: Blackboard) -&gt; str:</div>
<div class="line">    yasmin.YASMIN_LOG_INFO(f<span class="stringliteral">&quot;Sum: {blackboard[&#39;sum&#39;]}&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># main</span></div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line"> </div>
<div class="line">    yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_service_client_demo&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># init ROS 2</span></div>
<div class="line">    rclpy.init()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># set ROS 2 logs</span></div>
<div class="line">    set_ros_loggers()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create a FSM</span></div>
<div class="line">    sm = StateMachine(outcomes=[<span class="stringliteral">&quot;outcome4&quot;</span>])</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># add states</span></div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;SETTING_INTS&quot;</span>,</div>
<div class="line">        CbState([SUCCEED], set_ints),</div>
<div class="line">        transitions={SUCCEED: <span class="stringliteral">&quot;ADD_TWO_INTS&quot;</span>},</div>
<div class="line">    )</div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;ADD_TWO_INTS&quot;</span>,</div>
<div class="line">        AddTwoIntsState(),</div>
<div class="line">        transitions={</div>
<div class="line">            <span class="stringliteral">&quot;outcome1&quot;</span>: <span class="stringliteral">&quot;PRINTING_SUM&quot;</span>,</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">            ABORT: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;PRINTING_SUM&quot;</span>,</div>
<div class="line">        CbState([SUCCEED], print_sum),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># pub FSM info</span></div>
<div class="line">    YasminViewerPub(<span class="stringliteral">&quot;YASMIN_SERVICE_CLIENT_DEMO&quot;</span>, sm)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># execute FSM</span></div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        outcome = sm()</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(outcome)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        sm.cancel_state()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># shutdown ROS 2</span></div>
<div class="line">    <span class="keywordflow">if</span> rclpy.ok():</div>
<div class="line">        rclpy.shutdown()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    main()</div>
<div class="ttc" id="anamespaceyasmin__ros_1_1basic__outcomes_html"><div class="ttname"><a href="namespaceyasmin__ros_1_1basic__outcomes.html">yasmin_ros.basic_outcomes</a></div><div class="ttdef"><b>Definition</b> basic_outcomes.py:1</div></div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md10"></a>
Action Demo (FSM + ROS 2 Action)</h3>
<div class="fragment"><div class="line">$ ros2 run action_tutorials_cpp fibonacci_action_server</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ ros2 run yasmin_demos action_client_demo.py</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> rclpy</div>
<div class="line"><span class="keyword">from</span> action_tutorials_interfaces.action <span class="keyword">import</span> Fibonacci</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> yasmin</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> CbState</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> Blackboard</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> StateMachine</div>
<div class="line"><span class="keyword">from</span> yasmin_ros <span class="keyword">import</span> ActionState</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a> <span class="keyword">import</span> set_ros_loggers</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1basic__outcomes.html">yasmin_ros.basic_outcomes</a> <span class="keyword">import</span> SUCCEED, ABORT, CANCEL</div>
<div class="line"><span class="keyword">from</span> yasmin_viewer <span class="keyword">import</span> YasminViewerPub</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>FibonacciState(ActionState):</div>
<div class="line">    <span class="keyword">def </span>__init__(self) -&gt; None:</div>
<div class="line">        super().__init__(</div>
<div class="line">            Fibonacci,  <span class="comment"># action type</span></div>
<div class="line">            <span class="stringliteral">&quot;/fibonacci&quot;</span>,  <span class="comment"># action name</span></div>
<div class="line">            self.create_goal_handler,  <span class="comment"># cb to create the goal</span></div>
<div class="line">            <span class="keywordtype">None</span>,  <span class="comment"># outcomes. Includes (SUCCEED, ABORT, CANCEL)</span></div>
<div class="line">            self.response_handler,  <span class="comment"># cb to process the response</span></div>
<div class="line">            self.print_feedback,  <span class="comment"># cb to process the feedback</span></div>
<div class="line">        )</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>create_goal_handler(self, blackboard: Blackboard) -&gt; Fibonacci.Goal:</div>
<div class="line"> </div>
<div class="line">        goal = Fibonacci.Goal()</div>
<div class="line">        goal.order = blackboard[<span class="stringliteral">&quot;n&quot;</span>]</div>
<div class="line">        <span class="keywordflow">return</span> goal</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>response_handler(</div>
<div class="line">        self, blackboard: Blackboard, response: Fibonacci.Result</div>
<div class="line">    ) -&gt; str:</div>
<div class="line"> </div>
<div class="line">        blackboard[<span class="stringliteral">&quot;fibo_res&quot;</span>] = response.sequence</div>
<div class="line">        <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>print_feedback(</div>
<div class="line">        self, blackboard: Blackboard, feedback: Fibonacci.Feedback</div>
<div class="line">    ) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(f<span class="stringliteral">&quot;Received feedback: {list(feedback.partial_sequence)}&quot;</span>)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>print_result(blackboard: Blackboard) -&gt; str:</div>
<div class="line">    yasmin.YASMIN_LOG_INFO(f<span class="stringliteral">&quot;Result: {blackboard[&#39;fibo_res&#39;]}&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># main</span></div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line"> </div>
<div class="line">    yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_action_client_demo&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># init ROS 2</span></div>
<div class="line">    rclpy.init()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># set ROS 2 logs</span></div>
<div class="line">    set_ros_loggers()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create a FSM</span></div>
<div class="line">    sm = StateMachine(outcomes=[<span class="stringliteral">&quot;outcome4&quot;</span>])</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># add states</span></div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;CALLING_FIBONACCI&quot;</span>,</div>
<div class="line">        FibonacciState(),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;PRINTING_RESULT&quot;</span>,</div>
<div class="line">            CANCEL: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">            ABORT: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;PRINTING_RESULT&quot;</span>,</div>
<div class="line">        CbState([SUCCEED], print_result),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># pub FSM info</span></div>
<div class="line">    YasminViewerPub(<span class="stringliteral">&quot;YASMIN_ACTION_CLIENT_DEMO&quot;</span>, sm)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create an initial blackoard</span></div>
<div class="line">    blackboard = Blackboard()</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;n&quot;</span>] = 10</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># execute FSM</span></div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        outcome = sm(blackboard)</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(outcome)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        sm.cancel_state()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># shutdown ROS 2</span></div>
<div class="line">    <span class="keywordflow">if</span> rclpy.ok():</div>
<div class="line">        rclpy.shutdown()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    main()</div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md11"></a>
Monitor Demo (FSM + ROS 2 Subscriber)</h3>
<div class="fragment"><div class="line">$ ros2 run yasmin_demos monitor_demo.py</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> rclpy</div>
<div class="line"><span class="keyword">from</span> rclpy.qos <span class="keyword">import</span> qos_profile_sensor_data</div>
<div class="line"><span class="keyword">from</span> nav_msgs.msg <span class="keyword">import</span> Odometry</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> yasmin</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> Blackboard</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> StateMachine</div>
<div class="line"><span class="keyword">from</span> yasmin_ros <span class="keyword">import</span> MonitorState</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a> <span class="keyword">import</span> set_ros_loggers</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1basic__outcomes.html">yasmin_ros.basic_outcomes</a> <span class="keyword">import</span> TIMEOUT</div>
<div class="line"><span class="keyword">from</span> yasmin_viewer <span class="keyword">import</span> YasminViewerPub</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PrintOdometryState(MonitorState):</div>
<div class="line">    <span class="keyword">def </span>__init__(self, times: int) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line">        super().__init__(</div>
<div class="line">            Odometry,  <span class="comment"># msg type</span></div>
<div class="line">            <span class="stringliteral">&quot;odom&quot;</span>,  <span class="comment"># topic name</span></div>
<div class="line">            [<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;outcome2&quot;</span>],  <span class="comment"># outcomes</span></div>
<div class="line">            self.monitor_handler,  <span class="comment"># monitor handler callback</span></div>
<div class="line">            qos=qos_profile_sensor_data,  <span class="comment"># qos for the topic sbscription</span></div>
<div class="line">            msg_queue=10,  <span class="comment"># queue of the monitor handler callback</span></div>
<div class="line">            timeout=10,  <span class="comment"># timeout to wait for msgs in seconds</span></div>
<div class="line">            <span class="comment"># if not None, CANCEL outcome is added</span></div>
<div class="line">        )</div>
<div class="line">        self.times = times</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>monitor_handler(self, blackboard: Blackboard, msg: Odometry) -&gt; str:</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(msg)</div>
<div class="line"> </div>
<div class="line">        self.times -= 1</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> self.times &lt;= 0:</div>
<div class="line">            <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome2&quot;</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># main</span></div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line"> </div>
<div class="line">    yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_monitor_demo&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># init ROS 2</span></div>
<div class="line">    rclpy.init()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># set ROS 2 logs</span></div>
<div class="line">    set_ros_loggers()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create a FSM</span></div>
<div class="line">    sm = StateMachine(outcomes=[<span class="stringliteral">&quot;outcome4&quot;</span>])</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># add states</span></div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;PRINTING_ODOM&quot;</span>,</div>
<div class="line">        PrintOdometryState(5),</div>
<div class="line">        transitions={</div>
<div class="line">            <span class="stringliteral">&quot;outcome1&quot;</span>: <span class="stringliteral">&quot;PRINTING_ODOM&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;outcome2&quot;</span>: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">            TIMEOUT: <span class="stringliteral">&quot;outcome4&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># pub FSM info</span></div>
<div class="line">    YasminViewerPub(<span class="stringliteral">&quot;YASMIN_MONITOR_DEMO&quot;</span>, sm)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># execute FSM</span></div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        outcome = sm()</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(outcome)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        sm.cancel_state()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># shutdown ROS 2</span></div>
<div class="line">    <span class="keywordflow">if</span> rclpy.ok():</div>
<div class="line">        rclpy.shutdown()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    main()</div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md12"></a>
Nav2 Demo (Hierarchical FSM + ROS 2 Action)</h3>
<div class="fragment"><div class="line">$ ros2 run yasmin_demos nav_demo.py</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> random</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> rclpy</div>
<div class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Pose</div>
<div class="line"><span class="keyword">from</span> nav2_msgs.action <span class="keyword">import</span> NavigateToPose</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> yasmin</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> CbState</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> Blackboard</div>
<div class="line"><span class="keyword">from</span> yasmin <span class="keyword">import</span> StateMachine</div>
<div class="line"><span class="keyword">from</span> yasmin_ros <span class="keyword">import</span> ActionState</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1ros__logs.html">yasmin_ros.ros_logs</a> <span class="keyword">import</span> set_ros_loggers</div>
<div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespaceyasmin__ros_1_1basic__outcomes.html">yasmin_ros.basic_outcomes</a> <span class="keyword">import</span> SUCCEED, ABORT, CANCEL</div>
<div class="line"><span class="keyword">from</span> yasmin_viewer <span class="keyword">import</span> YasminViewerPub</div>
<div class="line"> </div>
<div class="line">HAS_NEXT = <span class="stringliteral">&quot;has_next&quot;</span></div>
<div class="line">END = <span class="stringliteral">&quot;end&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Nav2State(ActionState):</div>
<div class="line">    <span class="keyword">def </span>__init__(self) -&gt; None:</div>
<div class="line">        super().__init__(</div>
<div class="line">            NavigateToPose,  <span class="comment"># action type</span></div>
<div class="line">            <span class="stringliteral">&quot;/navigate_to_pose&quot;</span>,  <span class="comment"># action name</span></div>
<div class="line">            self.create_goal_handler,  <span class="comment"># cb to create the goal</span></div>
<div class="line">            <span class="keywordtype">None</span>,  <span class="comment"># outcomes. Includes (SUCCEED, ABORT, CANCEL)</span></div>
<div class="line">            <span class="keywordtype">None</span>,  <span class="comment"># cb to process the response</span></div>
<div class="line">        )</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>create_goal_handler(self, blackboard: Blackboard) -&gt; NavigateToPose.Goal:</div>
<div class="line"> </div>
<div class="line">        goal = NavigateToPose.Goal()</div>
<div class="line">        goal.pose.pose = blackboard[<span class="stringliteral">&quot;pose&quot;</span>]</div>
<div class="line">        goal.pose.header.frame_id = <span class="stringliteral">&quot;map&quot;</span></div>
<div class="line">        <span class="keywordflow">return</span> goal</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>create_waypoints(blackboard: Blackboard) -&gt; str:</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;waypoints&quot;</span>] = {</div>
<div class="line">        <span class="stringliteral">&quot;entrance&quot;</span>: [1.25, 6.30, -0.78, 0.67],</div>
<div class="line">        <span class="stringliteral">&quot;bathroom&quot;</span>: [4.89, 1.64, 0.0, 1.0],</div>
<div class="line">        <span class="stringliteral">&quot;livingroom&quot;</span>: [1.55, 4.03, -0.69, 0.72],</div>
<div class="line">        <span class="stringliteral">&quot;kitchen&quot;</span>: [3.79, 6.77, 0.99, 0.12],</div>
<div class="line">        <span class="stringliteral">&quot;bedroom&quot;</span>: [7.50, 4.89, 0.76, 0.65],</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>take_random_waypoint(blackboard) -&gt; str:</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;random_waypoints&quot;</span>] = random.sample(</div>
<div class="line">        list(blackboard[<span class="stringliteral">&quot;waypoints&quot;</span>].keys()), blackboard[<span class="stringliteral">&quot;waypoints_num&quot;</span>]</div>
<div class="line">    )</div>
<div class="line">    <span class="keywordflow">return</span> SUCCEED</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>get_next_waypoint(blackboard: Blackboard) -&gt; str:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> <span class="keywordflow">not</span> blackboard[<span class="stringliteral">&quot;random_waypoints&quot;</span>]:</div>
<div class="line">        <span class="keywordflow">return</span> END</div>
<div class="line"> </div>
<div class="line">    wp_name = blackboard[<span class="stringliteral">&quot;random_waypoints&quot;</span>].pop(0)</div>
<div class="line">    wp = blackboard[<span class="stringliteral">&quot;waypoints&quot;</span>][wp_name]</div>
<div class="line"> </div>
<div class="line">    pose = Pose()</div>
<div class="line">    pose.position.x = wp[0]</div>
<div class="line">    pose.position.y = wp[1]</div>
<div class="line"> </div>
<div class="line">    pose.orientation.z = wp[2]</div>
<div class="line">    pose.orientation.w = wp[3]</div>
<div class="line"> </div>
<div class="line">    blackboard[<span class="stringliteral">&quot;pose&quot;</span>] = pose</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;text&quot;</span>] = f<span class="stringliteral">&quot;I have reached waypoint {wp_name}&quot;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> HAS_NEXT</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># main</span></div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line"> </div>
<div class="line">    yasmin.YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_nav2_demo&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># init ROS 2</span></div>
<div class="line">    rclpy.init()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># set ROS 2 logs</span></div>
<div class="line">    set_ros_loggers()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># create state machines</span></div>
<div class="line">    sm = StateMachine(outcomes=[SUCCEED, ABORT, CANCEL])</div>
<div class="line">    nav_sm = StateMachine(outcomes=[SUCCEED, ABORT, CANCEL])</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># add states</span></div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;CREATING_WAYPOINTS&quot;</span>,</div>
<div class="line">        CbState([SUCCEED], create_waypoints),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;TAKING_RANDOM_WAYPOINTS&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;TAKING_RANDOM_WAYPOINTS&quot;</span>,</div>
<div class="line">        CbState([SUCCEED], take_random_waypoint),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;NAVIGATING&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    nav_sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;GETTING_NEXT_WAYPOINT&quot;</span>,</div>
<div class="line">        CbState([END, HAS_NEXT], get_next_waypoint),</div>
<div class="line">        transitions={</div>
<div class="line">            END: SUCCEED,</div>
<div class="line">            HAS_NEXT: <span class="stringliteral">&quot;NAVIGATING&quot;</span>,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line">    nav_sm.add_state(</div>
<div class="line">        <span class="stringliteral">&quot;NAVIGATING&quot;</span>,</div>
<div class="line">        Nav2State(),</div>
<div class="line">        transitions={</div>
<div class="line">            SUCCEED: <span class="stringliteral">&quot;GETTING_NEXT_WAYPOINT&quot;</span>,</div>
<div class="line">            CANCEL: CANCEL,</div>
<div class="line">            ABORT: ABORT,</div>
<div class="line">        },</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># pub FSM info</span></div>
<div class="line">    YasminViewerPub(<span class="stringliteral">&quot;YASMIN_NAV_DEMO&quot;</span>, sm)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># execute FSM</span></div>
<div class="line">    blackboard = Blackboard()</div>
<div class="line">    blackboard[<span class="stringliteral">&quot;waypoints_num&quot;</span>] = 2</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        outcome = sm(blackboard)</div>
<div class="line">        yasmin.YASMIN_LOG_INFO(outcome)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        sm.cancel_state()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># shutdown ROS 2</span></div>
<div class="line">    <span class="keywordflow">if</span> rclpy.ok():</div>
<div class="line">        rclpy.shutdown()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    main()</div>
</div><!-- fragment --><p></p>
</details>
<h2><a class="anchor" id="autotoc_md13"></a>
Cpp</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
Vanilla Demo</h3>
<div class="fragment"><div class="line">$ ros2 run yasmin_demos yasmin_demo</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;rclcpp/rclcpp.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/state_machine.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/ros_logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_viewer/yasmin_viewer_pub.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// define state Foo</span></div>
<div class="line"><span class="keyword">class </span>FooState : <span class="keyword">public</span> <a class="code hl_class" href="classyasmin_1_1state_1_1State.html">yasmin::State</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">int</span> counter;</div>
<div class="line"> </div>
<div class="line">  FooState() : <a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>::State({<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;outcome2&quot;</span>}) { this-&gt;counter = 0; };</div>
<div class="line"> </div>
<div class="line">  std::string</div>
<div class="line">  <a class="code hl_function" href="classyasmin_1_1state_1_1State.html#a531c80a2c77722089d92e7a9c73f69d8">execute</a>(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line">    YASMIN_LOG_INFO(<span class="stringliteral">&quot;Executing state FOO&quot;</span>);</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::seconds(3));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (this-&gt;counter &lt; 3) {</div>
<div class="line">      this-&gt;counter += 1;</div>
<div class="line">      blackboard-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;foo_str&quot;</span>,</div>
<div class="line">                                   <span class="stringliteral">&quot;Counter: &quot;</span> + std::to_string(this-&gt;counter));</div>
<div class="line">      <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome2&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// define state Bar</span></div>
<div class="line"><span class="keyword">class </span>BarState : <span class="keyword">public</span> <a class="code hl_class" href="classyasmin_1_1state_1_1State.html">yasmin::State</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  BarState() : <a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>::State({<span class="stringliteral">&quot;outcome3&quot;</span>}){};</div>
<div class="line"> </div>
<div class="line">  std::string</div>
<div class="line">  <a class="code hl_function" href="classyasmin_1_1state_1_1State.html#a531c80a2c77722089d92e7a9c73f69d8">execute</a>(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line">    YASMIN_LOG_INFO(<span class="stringliteral">&quot;Executing state BAR&quot;</span>);</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::seconds(3));</div>
<div class="line"> </div>
<div class="line">    YASMIN_LOG_INFO(blackboard-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;foo_str&quot;</span>).c_str());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome3&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceyasmin__viewer_1_1yasmin__viewer__node.html#aa5aebdb9275eede1a284bc242182d026">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_demo&quot;</span>);</div>
<div class="line">  rclcpp::init(argc, argv);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set ROS 2 logs</span></div>
<div class="line">  yasmin_ros::set_ros_loggers();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create a state machine</span></div>
<div class="line">  <span class="keyword">auto</span> sm = std::make_shared&lt;yasmin::StateMachine&gt;(</div>
<div class="line">      std::initializer_list&lt;std::string&gt;{<span class="stringliteral">&quot;outcome4&quot;</span>});</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// cancel state machine on ROS 2 shutdown</span></div>
<div class="line">  rclcpp::on_shutdown([sm]() {</div>
<div class="line">    <span class="keywordflow">if</span> (sm-&gt;is_running()) {</div>
<div class="line">      sm-&gt;cancel_state();</div>
<div class="line">    }</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// add states</span></div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;FOO&quot;</span>, std::make_shared&lt;FooState&gt;(),</div>
<div class="line">                {</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;BAR&quot;</span>},</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome2&quot;</span>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;BAR&quot;</span>, std::make_shared&lt;BarState&gt;(),</div>
<div class="line">                {</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome3&quot;</span>, <span class="stringliteral">&quot;FOO&quot;</span>},</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// pub</span></div>
<div class="line">  <a class="code hl_class" href="classyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub.html">yasmin_viewer::YasminViewerPub</a> yasmin_pub(<span class="stringliteral">&quot;yasmin_demo&quot;</span>, sm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// execute</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    std::string outcome = (*sm.get())();</div>
<div class="line">    YASMIN_LOG_INFO(outcome.c_str());</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line">    YASMIN_LOG_WARN(e.what());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  rclcpp::shutdown();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassyasmin_1_1state_1_1State_html"><div class="ttname"><a href="classyasmin_1_1state_1_1State.html">yasmin.state.State</a></div><div class="ttdef"><b>Definition</b> state.py:23</div></div>
<div class="ttc" id="aclassyasmin_1_1state_1_1State_html_a531c80a2c77722089d92e7a9c73f69d8"><div class="ttname"><a href="classyasmin_1_1state_1_1State.html#a531c80a2c77722089d92e7a9c73f69d8">yasmin.state.State.execute</a></div><div class="ttdeci">str execute(self, Blackboard blackboard)</div><div class="ttdef"><b>Definition</b> state.py:90</div></div>
<div class="ttc" id="aclassyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub_html"><div class="ttname"><a href="classyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub.html">yasmin_viewer.yasmin_viewer_pub.YasminViewerPub</a></div><div class="ttdef"><b>Definition</b> yasmin_viewer_pub.py:28</div></div>
<div class="ttc" id="anamespaceyasmin__viewer_1_1yasmin__viewer__node_html_aa5aebdb9275eede1a284bc242182d026"><div class="ttname"><a href="namespaceyasmin__viewer_1_1yasmin__viewer__node.html#aa5aebdb9275eede1a284bc242182d026">yasmin_viewer.yasmin_viewer_node.main</a></div><div class="ttdeci">None main()</div><div class="ttdef"><b>Definition</b> yasmin_viewer_node.py:199</div></div>
<div class="ttc" id="anamespaceyasmin_html"><div class="ttname"><a href="namespaceyasmin.html">yasmin</a></div><div class="ttdef"><b>Definition</b> __init__.py:1</div></div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md15"></a>
Service Demo (FSM + ROS 2 Service Client)</h3>
<div class="fragment"><div class="line">$ ros2 run demo_nodes_py add_two_ints_server</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ ros2 run yasmin_demos service_client_demo</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rclcpp/rclcpp.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/cb_state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/state_machine.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/basic_outcomes.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/ros_logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/service_state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_viewer/yasmin_viewer_pub.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>std::placeholders::_1;</div>
<div class="line"><span class="keyword">using </span>std::placeholders::_2;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>;</div>
<div class="line"> </div>
<div class="line">std::string</div>
<div class="line">set_ints(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line">  blackboard-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;a&quot;</span>, 10);</div>
<div class="line">  blackboard-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;b&quot;</span>, 5);</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string</div>
<div class="line">print_sum(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Sum: %d\n&quot;</span>, blackboard-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;sum&quot;</span>));</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>AddTwoIntsState</div>
<div class="line">    : <span class="keyword">public</span> <a class="code hl_class" href="classyasmin__ros_1_1service__state_1_1ServiceState.html">yasmin_ros::ServiceState</a>&lt;example_interfaces::srv::AddTwoInts&gt; {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  AddTwoIntsState()</div>
<div class="line">      : <a class="code hl_namespace" href="namespaceyasmin__ros.html">yasmin_ros</a>::ServiceState&lt;example_interfaces::srv::AddTwoInts&gt; <span class="comment">// msg</span></div>
<div class="line">        (                                                             <span class="comment">// node</span></div>
<div class="line">            <span class="stringliteral">&quot;/add_two_ints&quot;</span>, <span class="comment">// srv name</span></div>
<div class="line">            std::bind(&amp;AddTwoIntsState::create_request_handler, this, _1),</div>
<div class="line">            {<span class="stringliteral">&quot;outcome1&quot;</span>},</div>
<div class="line">            std::bind(&amp;AddTwoIntsState::response_handler, <span class="keyword">this</span>, _1, _2)){};</div>
<div class="line"> </div>
<div class="line">  example_interfaces::srv::AddTwoInts::Request::SharedPtr</div>
<div class="line">  create_request_handler(</div>
<div class="line">      std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> request =</div>
<div class="line">        std::make_shared&lt;example_interfaces::srv::AddTwoInts::Request&gt;();</div>
<div class="line"> </div>
<div class="line">    request-&gt;a = blackboard-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">    request-&gt;b = blackboard-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;b&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> request;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  std::string response_handler(</div>
<div class="line">      std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard,</div>
<div class="line">      example_interfaces::srv::AddTwoInts::Response::SharedPtr response) {</div>
<div class="line"> </div>
<div class="line">    blackboard-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;sum&quot;</span>, response-&gt;sum);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceyasmin__viewer_1_1yasmin__viewer__node.html#aa5aebdb9275eede1a284bc242182d026">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_service_client_demo&quot;</span>);</div>
<div class="line">  rclcpp::init(argc, argv);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set ROS 2 logs</span></div>
<div class="line">  yasmin_ros::set_ros_loggers();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create a state machine</span></div>
<div class="line">  <span class="keyword">auto</span> sm = std::make_shared&lt;yasmin::StateMachine&gt;(</div>
<div class="line">      std::initializer_list&lt;std::string&gt;{<span class="stringliteral">&quot;outcome4&quot;</span>});</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// cancel state machine on ROS 2 shutdown</span></div>
<div class="line">  rclcpp::on_shutdown([sm]() {</div>
<div class="line">    <span class="keywordflow">if</span> (sm-&gt;is_running()) {</div>
<div class="line">      sm-&gt;cancel_state();</div>
<div class="line">    }</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// add states</span></div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;SETTING_INTS&quot;</span>,</div>
<div class="line">                std::make_shared&lt;yasmin::CbState&gt;(</div>
<div class="line">                    std::initializer_list&lt;std::string&gt;{</div>
<div class="line">                        <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>},</div>
<div class="line">                    <a class="code hl_function" href="namespaceyasmin__demos_1_1service__client__demo.html#a522dc92d336019a6dd464206b9744011">set_ints</a>),</div>
<div class="line">                {</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>, <span class="stringliteral">&quot;ADD_TWO_INTS&quot;</span>},</div>
<div class="line">                });</div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;ADD_TWO_INTS&quot;</span>, std::make_shared&lt;AddTwoIntsState&gt;(),</div>
<div class="line">                {</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;PRINTING_SUM&quot;</span>},</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#aab7808b49a690522da9b7d1922f718b0">yasmin_ros::basic_outcomes::ABORT</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;PRINTING_SUM&quot;</span>,</div>
<div class="line">                std::make_shared&lt;yasmin::CbState&gt;(</div>
<div class="line">                    std::initializer_list&lt;std::string&gt;{</div>
<div class="line">                        <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>},</div>
<div class="line">                    <a class="code hl_function" href="namespaceyasmin__demos_1_1service__client__demo.html#aedfdd50b714611f271d7512ddb2549e1">print_sum</a>),</div>
<div class="line">                {</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// pub</span></div>
<div class="line">  <a class="code hl_class" href="classyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub.html">yasmin_viewer::YasminViewerPub</a> yasmin_pub(<span class="stringliteral">&quot;YASMIN_ACTION_CLIENT_DEMO&quot;</span>, sm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// execute</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    std::string outcome = (*sm.get())();</div>
<div class="line">    YASMIN_LOG_INFO(outcome.c_str());</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line">    YASMIN_LOG_WARN(e.what());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  rclcpp::shutdown();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassyasmin__ros_1_1service__state_1_1ServiceState_html"><div class="ttname"><a href="classyasmin__ros_1_1service__state_1_1ServiceState.html">yasmin_ros.service_state.ServiceState</a></div><div class="ttdef"><b>Definition</b> service_state.py:28</div></div>
<div class="ttc" id="anamespaceyasmin__demos_1_1service__client__demo_html_a522dc92d336019a6dd464206b9744011"><div class="ttname"><a href="namespaceyasmin__demos_1_1service__client__demo.html#a522dc92d336019a6dd464206b9744011">yasmin_demos.service_client_demo.set_ints</a></div><div class="ttdeci">str set_ints(Blackboard blackboard)</div><div class="ttdef"><b>Definition</b> service_client_demo.py:94</div></div>
<div class="ttc" id="anamespaceyasmin__demos_1_1service__client__demo_html_aedfdd50b714611f271d7512ddb2549e1"><div class="ttname"><a href="namespaceyasmin__demos_1_1service__client__demo.html#aedfdd50b714611f271d7512ddb2549e1">yasmin_demos.service_client_demo.print_sum</a></div><div class="ttdeci">str print_sum(Blackboard blackboard)</div><div class="ttdef"><b>Definition</b> service_client_demo.py:111</div></div>
<div class="ttc" id="anamespaceyasmin__ros_1_1basic__outcomes_html_aab7808b49a690522da9b7d1922f718b0"><div class="ttname"><a href="namespaceyasmin__ros_1_1basic__outcomes.html#aab7808b49a690522da9b7d1922f718b0">yasmin_ros.basic_outcomes.ABORT</a></div><div class="ttdeci">str ABORT</div><div class="ttdoc">Indicates that an operation was aborted before completion.</div><div class="ttdef"><b>Definition</b> basic_outcomes.py:24</div></div>
<div class="ttc" id="anamespaceyasmin__ros_1_1basic__outcomes_html_af61301abb8214fa901179eea171ee318"><div class="ttname"><a href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros.basic_outcomes.SUCCEED</a></div><div class="ttdeci">str SUCCEED</div><div class="ttdoc">Indicates that an operation has completed successfully.</div><div class="ttdef"><b>Definition</b> basic_outcomes.py:23</div></div>
<div class="ttc" id="anamespaceyasmin__ros_html"><div class="ttname"><a href="namespaceyasmin__ros.html">yasmin_ros</a></div><div class="ttdef"><b>Definition</b> __init__.py:1</div></div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md16"></a>
Action Demo (FSM + ROS 2 Action)</h3>
<div class="fragment"><div class="line">$ ros2 run action_tutorials_cpp fibonacci_action_server</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ ros2 run yasmin_demos action_client_demo</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;action_tutorials_interfaces/action/fibonacci.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/cb_state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/state_machine.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/action_state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/basic_outcomes.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/ros_logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/yasmin_node.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_viewer/yasmin_viewer_pub.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>std::placeholders::_1;</div>
<div class="line"><span class="keyword">using </span>std::placeholders::_2;</div>
<div class="line"><span class="keyword">using </span>Fibonacci = action_tutorials_interfaces::action::Fibonacci;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>;</div>
<div class="line"> </div>
<div class="line">std::string</div>
<div class="line">print_result(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> fibo_res = blackboard-&gt;get&lt;std::vector&lt;int&gt;&gt;(<span class="stringliteral">&quot;sum&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Result received:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> ele : fibo_res) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot; %d,&quot;</span>, ele);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>FibonacciState : <span class="keyword">public</span> <a class="code hl_class" href="classyasmin__ros_1_1action__state_1_1ActionState.html">yasmin_ros::ActionState</a>&lt;Fibonacci&gt; {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  FibonacciState()</div>
<div class="line">      : <a class="code hl_namespace" href="namespaceyasmin__ros.html">yasmin_ros</a>::ActionState&lt;Fibonacci&gt;(</div>
<div class="line"> </div>
<div class="line">            <span class="stringliteral">&quot;/fibonacci&quot;</span>, <span class="comment">// action name</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">// # cb to create the goal</span></div>
<div class="line">            std::bind(&amp;FibonacciState::create_goal_handler, this, _1),</div>
<div class="line">            <span class="comment">// # cb to process the response</span></div>
<div class="line"> </div>
<div class="line">            std::bind(&amp;FibonacciState::response_handler, this, _1, _2),</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// cb to process the feedback</span></div>
<div class="line">            std::bind(&amp;FibonacciState::print_feedback, this, _1, _2)){};</div>
<div class="line"> </div>
<div class="line">  Fibonacci::Goal create_goal_handler(</div>
<div class="line">      std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard) {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> goal = Fibonacci::Goal();</div>
<div class="line">    goal.order = blackboard-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> goal;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  std::string</div>
<div class="line">  response_handler(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard,</div>
<div class="line">                   Fibonacci::Result::SharedPtr response) {</div>
<div class="line"> </div>
<div class="line">    blackboard-&gt;set&lt;std::vector&lt;int&gt;&gt;(<span class="stringliteral">&quot;sum&quot;</span>, response-&gt;sequence);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  print_feedback(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard,</div>
<div class="line">                 std::shared_ptr&lt;const Fibonacci::Feedback&gt; feedback) {</div>
<div class="line">    (void)blackboard;</div>
<div class="line"> </div>
<div class="line">    std::stringstream ss;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;Next number in sequence received: &quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> number : feedback-&gt;partial_sequence) {</div>
<div class="line">      ss &lt;&lt; number &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;%s\n&quot;</span>, ss.str().c_str());</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceyasmin__viewer_1_1yasmin__viewer__node.html#aa5aebdb9275eede1a284bc242182d026">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_action_client_demo&quot;</span>);</div>
<div class="line">  rclcpp::init(argc, argv);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set ROS 2 logs</span></div>
<div class="line">  yasmin_ros::set_ros_loggers();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create a state machine</span></div>
<div class="line">  <span class="keyword">auto</span> sm = std::make_shared&lt;yasmin::StateMachine&gt;(</div>
<div class="line">      std::initializer_list&lt;std::string&gt;{<span class="stringliteral">&quot;outcome4&quot;</span>});</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// cancel state machine on ROS 2 shutdown</span></div>
<div class="line">  rclcpp::on_shutdown([sm]() {</div>
<div class="line">    <span class="keywordflow">if</span> (sm-&gt;is_running()) {</div>
<div class="line">      sm-&gt;cancel_state();</div>
<div class="line">    }</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// add states</span></div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;CALLING_FIBONACCI&quot;</span>, std::make_shared&lt;FibonacciState&gt;(),</div>
<div class="line">                {</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>, <span class="stringliteral">&quot;PRINTING_RESULT&quot;</span>},</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#aef344807a5c01c65ef6e81cfa1d395c6">yasmin_ros::basic_outcomes::CANCEL</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#aab7808b49a690522da9b7d1922f718b0">yasmin_ros::basic_outcomes::ABORT</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;PRINTING_RESULT&quot;</span>,</div>
<div class="line">                std::make_shared&lt;yasmin::CbState&gt;(</div>
<div class="line">                    std::initializer_list&lt;std::string&gt;{</div>
<div class="line">                        <a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>},</div>
<div class="line">                    <a class="code hl_function" href="namespaceyasmin__demos_1_1action__client__demo.html#aa1b52df73df29943208e8d1a502b9d6e">print_result</a>),</div>
<div class="line">                {</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#af61301abb8214fa901179eea171ee318">yasmin_ros::basic_outcomes::SUCCEED</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// pub</span></div>
<div class="line">  <a class="code hl_class" href="classyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub.html">yasmin_viewer::YasminViewerPub</a> yasmin_pub(<span class="stringliteral">&quot;YASMIN_ACTION_CLIENT_DEMO&quot;</span>, sm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create an initial blackboard</span></div>
<div class="line">  std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard =</div>
<div class="line">      std::make_shared&lt;yasmin::blackboard::Blackboard&gt;();</div>
<div class="line">  blackboard-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;n&quot;</span>, 10);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// execute</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    std::string outcome = (*sm.get())(blackboard);</div>
<div class="line">    YASMIN_LOG_INFO(outcome.c_str());</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line">    YASMIN_LOG_WARN(e.what());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  rclcpp::shutdown();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassyasmin__ros_1_1action__state_1_1ActionState_html"><div class="ttname"><a href="classyasmin__ros_1_1action__state_1_1ActionState.html">yasmin_ros.action_state.ActionState</a></div><div class="ttdef"><b>Definition</b> action_state.py:32</div></div>
<div class="ttc" id="anamespaceyasmin__demos_1_1action__client__demo_html_aa1b52df73df29943208e8d1a502b9d6e"><div class="ttname"><a href="namespaceyasmin__demos_1_1action__client__demo.html#aa1b52df73df29943208e8d1a502b9d6e">yasmin_demos.action_client_demo.print_result</a></div><div class="ttdeci">str print_result(Blackboard blackboard)</div><div class="ttdef"><b>Definition</b> action_client_demo.py:126</div></div>
<div class="ttc" id="anamespaceyasmin__ros_1_1basic__outcomes_html_aef344807a5c01c65ef6e81cfa1d395c6"><div class="ttname"><a href="namespaceyasmin__ros_1_1basic__outcomes.html#aef344807a5c01c65ef6e81cfa1d395c6">yasmin_ros.basic_outcomes.CANCEL</a></div><div class="ttdeci">str CANCEL</div><div class="ttdoc">Indicates that an operation was canceled by the user or system.</div><div class="ttdef"><b>Definition</b> basic_outcomes.py:25</div></div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md17"></a>
Monitor Demo (FSM + ROS 2 Subscriber)</h3>
<div class="fragment"><div class="line">$ ros2 run yasmin_demos monitor_demo</div>
</div><!-- fragment --><details >
<summary >
Click to expand</summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;rclcpp/rclcpp.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;nav_msgs/msg/odometry.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin/state_machine.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/basic_outcomes.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/monitor_state.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_ros/ros_logs.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yasmin_viewer/yasmin_viewer_pub.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>std::placeholders::_1;</div>
<div class="line"><span class="keyword">using </span>std::placeholders::_2;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyasmin.html">yasmin</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PrintOdometryState</div>
<div class="line">    : <span class="keyword">public</span> <a class="code hl_class" href="classyasmin__ros_1_1monitor__state_1_1MonitorState.html">yasmin_ros::MonitorState</a>&lt;nav_msgs::msg::Odometry&gt; {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">int</span> times;</div>
<div class="line"> </div>
<div class="line">  PrintOdometryState(<span class="keywordtype">int</span> times)</div>
<div class="line">      : <a class="code hl_namespace" href="namespaceyasmin__ros.html">yasmin_ros</a>::MonitorState&lt;nav_msgs::msg::Odometry&gt; <span class="comment">// msg type</span></div>
<div class="line">        (<span class="stringliteral">&quot;odom&quot;</span>,                                          <span class="comment">// topic name</span></div>
<div class="line">         {<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;outcome2&quot;</span>},                        <span class="comment">// outcomes</span></div>
<div class="line">         std::bind(&amp;PrintOdometryState::monitor_handler, <span class="keyword">this</span>, _1,</div>
<div class="line">                   _2), <span class="comment">// monitor handler callback</span></div>
<div class="line">         10,            <span class="comment">// qos for the topic sbscription</span></div>
<div class="line">         10,            <span class="comment">// queue of the monitor handler callback</span></div>
<div class="line">         10             <span class="comment">// timeout to wait for msgs in seconds</span></div>
<div class="line">                        <span class="comment">// if &gt;0, CANCEL outcome is added</span></div>
<div class="line">        ) {</div>
<div class="line">    this-&gt;times = times;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  std::string</div>
<div class="line">  monitor_handler(std::shared_ptr&lt;yasmin::blackboard::Blackboard&gt; blackboard,</div>
<div class="line">                  std::shared_ptr&lt;nav_msgs::msg::Odometry&gt; msg) {</div>
<div class="line"> </div>
<div class="line">    (void)blackboard;</div>
<div class="line"> </div>
<div class="line">    YASMIN_LOG_INFO(<span class="stringliteral">&quot;x: %d&quot;</span>, msg-&gt;pose.pose.position.x);</div>
<div class="line">    YASMIN_LOG_INFO(<span class="stringliteral">&quot;y: %d&quot;</span>, msg-&gt;pose.pose.position.y);</div>
<div class="line">    YASMIN_LOG_INFO(<span class="stringliteral">&quot;z: %d&quot;</span>, msg-&gt;pose.pose.position.z);</div>
<div class="line"> </div>
<div class="line">    this-&gt;times--;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (this-&gt;times &lt;= 0) {</div>
<div class="line">      <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome2&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;outcome1&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceyasmin__viewer_1_1yasmin__viewer__node.html#aa5aebdb9275eede1a284bc242182d026">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  YASMIN_LOG_INFO(<span class="stringliteral">&quot;yasmin_monitor_demo&quot;</span>);</div>
<div class="line">  rclcpp::init(argc, argv);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set ROS 2 logs</span></div>
<div class="line">  yasmin_ros::set_ros_loggers();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create a state machine</span></div>
<div class="line">  <span class="keyword">auto</span> sm = std::make_shared&lt;yasmin::StateMachine&gt;(</div>
<div class="line">      std::initializer_list&lt;std::string&gt;{<span class="stringliteral">&quot;outcome4&quot;</span>});</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// cancel state machine on ROS 2 shutdown</span></div>
<div class="line">  rclcpp::on_shutdown([sm]() {</div>
<div class="line">    <span class="keywordflow">if</span> (sm-&gt;is_running()) {</div>
<div class="line">      sm-&gt;cancel_state();</div>
<div class="line">    }</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// add states</span></div>
<div class="line">  sm-&gt;add_state(<span class="stringliteral">&quot;PRINTING_ODOM&quot;</span>, std::make_shared&lt;PrintOdometryState&gt;(5),</div>
<div class="line">                {</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome1&quot;</span>, <span class="stringliteral">&quot;PRINTING_ODOM&quot;</span>},</div>
<div class="line">                    {<span class="stringliteral">&quot;outcome2&quot;</span>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                    {<a class="code hl_variable" href="namespaceyasmin__ros_1_1basic__outcomes.html#ac68b50ac3123121d3caf32174e064abb">yasmin_ros::basic_outcomes::TIMEOUT</a>, <span class="stringliteral">&quot;outcome4&quot;</span>},</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// pub</span></div>
<div class="line">  <a class="code hl_class" href="classyasmin__viewer_1_1yasmin__viewer__pub_1_1YasminViewerPub.html">yasmin_viewer::YasminViewerPub</a> yasmin_pub(<span class="stringliteral">&quot;YASMIN_MONITOR_DEMO&quot;</span>, sm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// execute</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    std::string outcome = (*sm.get())();</div>
<div class="line">    YASMIN_LOG_INFO(outcome.c_str());</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line">    YASMIN_LOG_WARN(e.what());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  rclcpp::shutdown();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassyasmin__ros_1_1monitor__state_1_1MonitorState_html"><div class="ttname"><a href="classyasmin__ros_1_1monitor__state_1_1MonitorState.html">yasmin_ros.monitor_state.MonitorState</a></div><div class="ttdef"><b>Definition</b> monitor_state.py:29</div></div>
<div class="ttc" id="anamespaceyasmin__ros_1_1basic__outcomes_html_ac68b50ac3123121d3caf32174e064abb"><div class="ttname"><a href="namespaceyasmin__ros_1_1basic__outcomes.html#ac68b50ac3123121d3caf32174e064abb">yasmin_ros.basic_outcomes.TIMEOUT</a></div><div class="ttdeci">str TIMEOUT</div><div class="ttdoc">Indicates that an operation has timed out and did not complete in a timely manner.</div><div class="ttdef"><b>Definition</b> basic_outcomes.py:26</div></div>
</div><!-- fragment --><p></p>
</details>
<p><a class="anchor" id="#YASMIN-Viewer"></a></p>
<h1><a class="anchor" id="autotoc_md18"></a>
YASMIN Viewer</h1>
<p>This viewer allows monitoring YASMIN's FSM. It is implemented with Flask and ReactJS. A filter is provided to show only one FSM.</p>
<p><img src="./docs/viewer.gif" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md19"></a>
Usage</h2>
<div class="fragment"><div class="line">$ ros2 run yasmin_viewer yasmin_viewer_node</div>
</div><!-- fragment --><p><a href="http://localhost:5000/">http://localhost:5000/</a></p>
<h2><a class="anchor" id="autotoc_md20"></a>
Custom host and port</h2>
<div class="fragment"><div class="line">$ ros2 run yasmin_viewer yasmin_viewer_node --ros-args -p host:=127.0.0.1 -p port:=5032</div>
</div><!-- fragment --><p><a href="http://127.0.0.1:5032/">http://127.0.0.1:5032/</a></p>
<h1><a class="anchor" id="autotoc_md21"></a>
Citations</h1>
<div class="fragment"><div class="line">@InProceedings{10.1007/978-3-031-21062-4_43,</div>
<div class="line">author=&quot;Gonz{\&#39;a}lez-Santamarta, Miguel {\&#39;A}.</div>
<div class="line">and Rodr{\&#39;i}guez-Lera, Francisco J.</div>
<div class="line">and Matell{\&#39;a}n-Olivera, Vicente</div>
<div class="line">and Fern{\&#39;a}ndez-Llamas, Camino&quot;,</div>
<div class="line">editor=&quot;Tardioli, Danilo</div>
<div class="line">and Matell{\&#39;a}n, Vicente</div>
<div class="line">and Heredia, Guillermo</div>
<div class="line">and Silva, Manuel F.</div>
<div class="line">and Marques, Lino&quot;,</div>
<div class="line">title=&quot;YASMIN: Yet Another State MachINe&quot;,</div>
<div class="line">booktitle=&quot;ROBOT2022: Fifth Iberian Robotics Conference&quot;,</div>
<div class="line">year=&quot;2023&quot;,</div>
<div class="line">publisher=&quot;Springer International Publishing&quot;,</div>
<div class="line">address=&quot;Cham&quot;,</div>
<div class="line">pages=&quot;528--539&quot;,</div>
<div class="line">abstract=&quot;State machines are a common mechanism for defining behaviors in robots where each behavior is based on identifiable stages. There are several libraries available for easing the implementation of state machines in ROS 1, however, the community was focused on SMACH or SMACC. Although these tools are still predominant, there are fewer alternatives for ROS 2. Besides, Behavior Trees are spreading fast, but there is a niche for using State Machines. Here, YASMIN is presented as yet another library specifically designed for ROS 2 for easing the design of robotic behaviors using state machines. It is available in C++ and Python, and provides some default states to speed up the development, in addition to a web viewer for monitoring the execution of the system and helping in the debugging.&quot;,</div>
<div class="line">isbn=&quot;978-3-031-21062-4&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">@misc{yasmin,</div>
<div class="line">  doi = {10.48550/ARXIV.2205.13284},</div>
<div class="line">  url = {https://arxiv.org/abs/2205.13284},</div>
<div class="line">  author = {González-Santamarta, Miguel Ángel and Rodríguez-Lera, Francisco Javier and Llamas, Camino Fernández and Rico, Francisco Martín and Olivera, Vicente Matellán},</div>
<div class="line">  keywords = {Robotics (cs.RO), FOS: Computer and information sciences, FOS: Computer and information sciences},</div>
<div class="line">  title = {YASMIN: Yet Another State MachINe library for ROS 2},</div>
<div class="line">  publisher = {arXiv},</div>
<div class="line">  year = {2022},</div>
<div class="line">  copyright = {Creative Commons Attribution Non Commercial No Derivatives 4.0 International}</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
